<!DOCTYPE html>
<html>
<!----------------------------------------------------------

	Copyright (c) 2018 Jean-Marc VIGLINO,
	released under CeCILL-B (french BSD like) licence: http://www.cecill.info/

------------------------------------------------------------>
<head>
	<title>MAPA DE TODAS LAS REGIONES</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="description" content="A cluster layer for OpenLayers (ol/ol3) that animates clusters on zoom change." />
	<meta name="keywords" content="ol3,cluster,charts,animation,layer,selectio,animate,animated clusters,openlayers" />

	<!-- jQuery -->
	<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.0.min.js"></script>

	<!-- Openlayers -->
  <link rel="stylesheet" href="https://openlayers.org/en/latest/css/ol.css" />
	<script type="text/javascript" src="https://openlayers.org/en/latest/build/ol.js"></script>
  <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL,Object.assign"></script>
	
	<!-- ol-ext -->
	<script type="text/javascript" src="dist/ol-ext.js"></script>

	<!-- ol-ext maki and fontawesome defintions used in fontsymbol -->
	<link rel="stylesheet" href="css/fontmaki.css" />
	<script type="text/javascript" src="dist/extra/FontMakiDef.js"></script>

	<link rel="stylesheet" href="style.css" />
	<style>
		.infos > i {
			float: left;
			font-size: 3em;
			margin: -.2em 0 -.2em -.2em;
		}
		[class^="maki-"]:before, [class*=" maki-"]:before {
			width: initial;
		}
	</style>

</head>
<body >
	<!---
  <a href="https://github.com/Viglino/ol-ext" class="icss-github-corner"><i></i></a>
  -->
	<!-- DIV pour la carte -->
	<img src="LEYENDAIMG.png">
	<div id="map" style="width:90%; height:90%;"></div>


	<!--
  <div class="options">
		<h2>
			Cluster options:
		</h2>
		<input id="animatecluster" type="checkbox" checked="checked" onchange="clusterLayer.set('animationDuration',(this.checked ? 700:0));" />
		<label for="animatecluster">animate cluster</label>
		<br />
		Number of features:
		<br/>
		<input type="number" value="2000" onchange="addFeatures(this.value);" />
		<h2>Select options:</h2>
		<input id="animatesel" type="checkbox" checked="checked" onchange="selectCluster.animate = this.checked" />
		<label for="animatesel">animate selection</label>
	</div> 
  -->
	<div class="infos">
		
		<i class="fa maki-bus" title="building"></i>
		<i class="fa maki-town_hall" title="building"></i>
		<i class="fa maki-theatre" title="building"></i>
		<i class="fa maki-industrial" title="building"></i>
	</div>

	<script type="text/javascript">

//Coordinates DPA VERDES
var dpa=[];
var dpaname=[];



//ANCASH
dpa[0] = [-8752727.671907, -1008854.117822];//AUTRAL GROUP SA
dpaname[0]='AUSTRAL GROUP S.A.';
dpa[1] = [-8750128.812946, -1014625.113457]; //MUEELLE ENAPU
dpaname[1]='MUELLE ENAPU';
dpa[2] = [-8748619.181637, -1014873.533799];//DPA CHIMBOTE
dpaname[2]='DPA CHIMBOTE';
dpa[3] = [-8747931.248382, -1015313.046712];//MUELLE UGLAN SA
dpaname[3]='MUELLE UGLAN S.A.';
dpa[4] = [-8747319.752156, -1015771.668882];//MUELLE VLACAR SA
dpaname[4]='MUELLE VLACAR S.A.';
dpa[5] = [-8746861.129986, -1016077.416995];//MUELLE NAFTES SA
dpaname[5]='MUELLE NAFTES S.A.';
dpa[6] = [-8746517.163359, -1016631.585450];//MUELLE PRINCIPAL CENTENARIO
dpaname[6]='MUELLE PRINCIPAL CENTENARIO';
dpa[7] = [-8739465.847500, -1035091.127781];//MUELE CASAMAR SA
dpaname[7]='MUELLE CASAMAR S.A.';
dpa[8] = [-8735567.559057, -1043136.125008];//DPA CHIMUS
dpaname[8]='DPA CHIMUS';
dpa[9] = [-8726643.536005, -1058022.236266];//DPA CASMA
dpaname[9]='DPA CASMA';


//LIMA
dpa[10] = [-8702661.418380, -1130656.522394]; //ENAPU SUPE
dpaname[10]='ENAPU SUPE';
dpa[11] = [-8639065.810847, -1256471.870952]; //ENAPU HUACHO
dpaname[11]='ENAPU HUACHO';
dpa[12] = [-8642123.291979, -1256471.870952]; //DPA HUACHO
dpaname[12]='DPA HUACHO';
dpa[13] = [-8602528.911327, -1294537.511038]; //DPA CHANCAY
dpaname[13]='DPA CHANCAY';
dpa[14] = [-8590298.986801, -1316551.375184]; //MOLO MUELLE DE ANCON
dpaname[14]='MOLO MUELLE DE ANCON';
dpa[15] = [-8588158.750009, -1333367.521407]; //MUELLE TASA
dpaname[15]='MUELLE TASA';
dpa[16] = [-8587088.631613, -1338412.365273]; //MUELLE CENTENARIO
dpaname[16]='MUELLE CENTENARIO';
dpa[17] = [-8587088.631613, -1346973.312441]; //MUELLE DESEMBARCADERO PUERTOS DEL PACIFICO S.A.
dpaname[17]='MUELLE DESEMBARCADERO PUERTOS DEL PACIFICO S.A.';
dpa[18] = [-8588005.875953, -1348807.801120]; //DPA CALLAO
dpaname[18]='DPA CALLAO';
dpa[19] = [-8575317.329257, -1361037.725646]; //DPA CHORRILLOS
dpaname[19]='DPA CHORRILLOS';
dpa[20] = [-8549022.991527, -1400632.106298]; //DPA PUCUSANA
dpaname[20]='DPA PUCUSANA';
dpa[21] = [-8513861.958516, -1462393.225152]; //DPA CERRO AZUL
dpaname[21]='DPA CERRO AZUL';

//AREQUIPA
dpa[22] = [-8331559.646056, -1754153.362117]; //DPA LOMAS
dpaname[22]='DPA LOMAS';
dpa[23] = [-8265365.179561, -1789620.143241]; //DPA CHALA
dpaname[23]='DPA CHALA';
dpa[24] = [-8194355.180284, -1831431.197713]; //DPA ATICO
dpaname[24]='DPA ATICO';
dpa[25] = [-8160187.828641, -1846947.914455]; //IPA LA PLANCHADA
dpaname[25]='IPA LA PLANCHADA';
dpa[26] = [-8084744.481723, -1881191.703126]; //IPA QUILCA
dpaname[26]='IPA QUILCA';
dpa[27] = [-8027263.836453, -1922161.950287]; //DPP MATARANI
dpaname[27]='DPA MATARANI';

//MOQUEGUA Y TACNA
dpa[28] = [-7942036.549915, -1995847.245554]; //DPA ILO
dpaname[28]='DPA ILO';
dpa[29] = [-7908710.005582, -2023441.012765]; //CALETA PUNTA PICATA
dpaname[29]='CALETA PUNTA PICATA';
dpa[30] = [-7890823.740964, -2037352.551913]; //DPA MORRO SAMA
dpaname[30]='DPA MORRO SAMA';
dpa[31] = [-7873472.535543, -2050805.468891]; //DPA VILA
dpaname[31]='DPA VILA';

//ICA
dpa[32] = [-8485427.383994, -1543110.727021]; //DPA SAN ANDRES 1,2,3,4
dpaname[32]='DPA SAN ANDRES';
dpa[33] = [-8486038.880220, -1547085.452492];
dpaname[33]='DPA SAN ANDRES';
dpa[34] = [-8487414.746729, -1551060.177963];
dpaname[34]='DPA SAN ANDRES';
dpa[35] = [-8495669.945784, -1562372.858149];
dpaname[35]='DPA SAN ANDRES';
dpa[36] = [-8367943.671520, -1731050.270317]; //DPA SAN JUAN MARCONA
dpaname[36]='DPA SAN JUAN MARCONA';

//TUMBES

dpa[37] = [-8949094.397572, -390287.466424]; //DPA PUERTO PIZARRO
dpaname[37]='DPA PUERTO PIZARRO';
dpa[38] = [-8972178.380114, -404504.753685]; //PLAYA LA CRUZ
dpaname[38]='PLAYA LA CRUZ';
dpa[39] = [-8978293.342377, -408785.227269]; //PLAYA CALETA GRAU
dpaname[39]='PLAYA CALETA GRAU';
dpa[40] = [-8993274.999921, -420862.277738]; // DPA ACAPULCO
dpaname[40]='DPA ACAPULCO';
dpa[41] = [-9006422.168786, -436914.053678]; //PLAYA PUNTA MERO
dpaname[41]='PLAYA PUNTA MERO';
dpa[42] = [-9011008.390483, -441806.023488]; //DPA CANCAS
dpaname[42]='DPA CANCAS';


//PIURA Y PAITA
dpa[43] = [-9022779.692839, -457552.051315]; //DPA MANCORA
dpaname[43]='DPA MANCORA';
dpa[44] = [-9027977.410762, -465042.880087]; //DPA LOS ORGANOS
dpaname[44]='DPA LOS ORGANOS';
dpa[45] = [-9039901.587175, -471922.212633]; //DPA EL ÑURO
dpaname[45]='DPA EL ÑURO';
dpa[46] = [-9048462.534343, -504637.260739]; //MUELLE TERMINAL PESQUERO ZONAL DE TALARA
dpaname[46]='MUELLE TERMINA PESQUERO ZONAL DE TALARA';
dpa[47] = [-9023696.937178, -560283.417330]; //MUELLE IBT
dpaname[47]='MUELLE IBT';
dpa[48] = [-9031187.765950, -565481.135254]; //DPA MI MANUELITO
dpaname[48]='DPA MI MANUELITO';
dpa[49] = [-9036079.735760, -572666.215913]; //MUELLE DE PESQ HAYDUK SA
dpaname[49]='MUELLE DE PESQUERA HAYDUK S.A.';
dpa[50] = [-9035621.113591, -574194.956478]; //MUELLE DE ESTACION NAVAL DE PAITA
dpaname[50]='MUELLE DE ESTACION NAVAL DE PAITA';
dpa[51] = [-9035621.113591, -576793.815440]; //MUELLE CONSERVERA LAS AMERICAS
dpaname[51]='MUELLE CONSERVERA LAS AMERICAS';
dpa[52] = [-9036538.357930, -578169.681949]; //MUELLE DE INDUSTRIA ATUNERA
dpaname[52]='MUELLE DE INDUSTRIA ATUNERA';
dpa[53] = [-9038067.098496, -580309.918741]; //MUELLE DE PESQ NIVAMA
dpaname[53]='MUELLE DE PESQUERA NIVAMA';
dpa[54] = [-9036385.483874, -582755.903646]; //MUELLE DE IND PESQ SANTA MONICA
dpaname[54]='MUELLE DE INDUSTRIA PESQUERA SANTA MONICA';
dpa[55] = [-9026601.544253, -591316.850814]; //MUELLE DE PESQ. EXALMAR.
dpaname[55]='MUELLE DE PESQ. EXALMAR';
dpa[56] = [-9001377.324919, -624949.143260]; //MUELLE PESCA Y TRANSPORTE SA (EX DP JUAN PABLO)
dpaname[56]='MUELLE DE PESCA Y TRANSPORTE S.A. (EX DP SAN PABLO)';
dpa[57] = [-9012537.131049, -652160.725329]; //DPA GALILEO
dpaname[57]='DPA GALILEO';
//dpa[42] = [-901100390483, -4418063488]; //



//-TYPE 3 : PESCA CON CHINCHORRO Y EXPLOSIVOS
var tnt=[];

//ANCASH
tnt[0] = [-8744224.052511, -1025632.045530];
tnt[1] = [-8742695.311945, -1025632.045530];
tnt[2] = [-8740879.932523, -1025956.902901];
tnt[3] = [-8739312.973443, -1026778.600955];
tnt[4] = [-8734086.591634, -1042486.410267];
tnt[5] = [-8729667.575936, -1053221.035427];
tnt[6] = [-8729079.966282, -1053827.754339];
tnt[7] = [-8727761.427544, -1059359.884261];
tnt[8] = [-8727207.259089, -1060945.952598];
tnt[9] = [-8726872.847090, -1062379.146879];
tnt[10] = [-8725974.712007, -1065685.048352];
tnt[11] = [-8725477.871324, -1067213.788918];
tnt[12] = [-8716802.268613, -1084029.935140];
//CORREGIR CASI TODO
//tnt[0] = [-87471468842, -9995618885];







//-TYPE 0: OPERATIVOS EN CARRETERAS
var car=[];

//ANCASH
car[0] = [-8747147.768842, -999567.018885];
car[1] = [-8751256.259113, -1009924.236218];
car[2] = [-8746975.785529, -1015790.778139];
car[3] = [-8735682.214600, -1026434.634327];
car[4] = [-8723547.836359, -1053818.199711];






  // Layers
  var layers = [ new ol.layer.Tile({
    source: new ol.source.OSM()
  })];

  // The map
  var map = new ol.Map({
    target: 'map',
    view: new ol.View({
      zoom: 6,
      center: [-8750326, -1032663]
    }),
    layers: layers
  });

map.projection

  // CLUSTER PARA EL DPA
  function addFeatures(nb) {
    var ext = map.getView().calculateExtent(map.getSize());
    var features=[];
    for (var i=0; i<=57; ++i) {
      features[i] = new ol.Feature(new ol.geom.Point(dpa[i]));
      features[i].set('id',i);
      features[i].set('type', 1);
            features[i].set('name', dpaname[i]);   //Cantidad de colores, clases de clousters
    }

    for (var i=0; i<=4; ++i) {
      features[i+58] = new ol.Feature(new ol.geom.Point(car[i]));
      features[i+58].set('id',i+58);
      features[i+58].set('type', 0); 
      features[i+58].set('name', 'Operativos en carreteras');  //Cantidad de colores, clases de clousters
    }

    for (var i=0; i<=12; ++i) {
      features[i+63] = new ol.Feature(new ol.geom.Point(tnt[i]));
      features[i+63].set('id',i+63);
      features[i+63].set('type', 2); 
      features[i+63].set('name', 'Pesca con Chinchorro y Explosivos');  //Cantidad de colores, clases de clousters
    }



      //features[58] = new ol.Feature(new ol.geom.Point([-8949094.397572, -390287.466424]));
      //features[58].set('id',58);
      //features[58].set('type', 2) 

      //features[11] = new ol.Feature(new ol.geom.Point([-8739326, -1057663]));
      //features[11].set('id',11);
      //features[11].set('type', 3) 






    clusterSource.getSource().clear();
    clusterSource.getSource().addFeatures(features);
  }

  // Style for the clusters
  var styleCache = {};
  function getStyle (feature, resolution) {
    var features = feature.get('features');
    var size = features.length;
    // Feature style
    if (size===1) return featureStyle(feature);
    // ClusterStyle
    else {
      var data = [0,0,0,0];
      for (var i=0, f; f=features[i]; i++) data[f.get('type')]++;
      var style = styleCache[data.join(',')];
      if (!style) {
        var radius = Math.min(size+8, 20);
        style = styleCache[data.join(',')] = new ol.style.Style({
          image: new ol.style.Chart({
            type: 'pie', 
            radius: radius, 
            data: data, 
            rotateWithView: true,
            stroke: new ol.style.Stroke({
              color: "rgba(0,0,0,0)",
              width: 0
            })
          })

        });
      }
      return [style];
    }
  }

  // Style for the features
  var form = ['bus', 'square', 'town_hall', 'town_hall'];
  function featureStyle(f) {
    var sel = f.get('features')
    if (sel) {
      var type = sel[0].get('type');
      var style = styleCache[type];
      if (!style) {
        var color = ol.style.Chart.colors.classic[type];
        style = styleCache[type] = new ol.style.Style({
          image:  new ol.style.FontSymbol({
            glyph: 'maki-'+form[type],
            radius: 12,
            color: color,	
            fill: new ol.style.Fill({
              color:color
            }),
            stroke: new ol.style.Stroke ({
              color: '#fff',
              width: 1
            })
          })
        });
      }
      return [style];
    }
    else return [ new ol.style.Style({
      // Draw a link beetween points (or not)
      stroke: new ol.style.Stroke({
        color:"#fff", 
        width:1 
      }) 
    })];
  }

  // Cluster Source
  var clusterSource=new ol.source.Cluster({
    distance: 40,
    source: new ol.source.Vector()
  });
  // Animated cluster layer
  var clusterLayer = new ol.layer.AnimatedCluster({
    name: 'Cluster',
    source: clusterSource,
    animationDuration: $("#animatecluster").prop('checked') ? 700:0,
    // Cluster style
    style: getStyle
  });
  map.addLayer(clusterLayer);
  // add 2000 features
  addFeatures(200);
  
  // Select interaction to spread cluster out and select features
  var selectCluster = new ol.interaction.SelectCluster({
    // Point radius: to calculate distance between the features
    pointRadius:10,
    animate: $("#animatesel").prop('checked'),
    // Feature style when it springs apart
    featureStyle: featureStyle,
    selectCluster: false,	// disable cluster selection
  });
  map.addInteraction(selectCluster);

  // On selected => get feature in cluster and show info
  selectCluster.getFeatures().on(['add'], function (e){
    var c = e.element.get('features');
    if (c.length==1) {
      var feature = c[0];
      var color = ol.style.Chart.colors.classic[feature.get('type')];
      $(".infos").html(
        //"<i class='maki-"+form[feature.get('type')]+"' style='color:"+color+"'></i>"+
        //"One feature selected...<br/>(type="+ feature.get('name')+")"

        "<i class='maki-"+form[feature.get('type')]+"' style='color:"+color+"'></i>"+
        "<br/>"+ feature.get('name')
      );
    } else {
      $(".infos").text("Cluster ("+c.length+" features)");
    }
  })
  selectCluster.getFeatures().on(['remove'], function (e) {
    $(".infos").html("");
  })

  function testFontLoaded () {
    console.log('TEST', $(".maki-bus").width())
    // Loaded ?
    if ($(".maki-bus").width() > 60) {
      styleCache = {};
    } else {
      setTimeout(testFontLoaded,100);
    }
  }
  testFontLoaded ();

	</script>

</body>
</html>
